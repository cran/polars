<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>An Introduction to Polars from R</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">An Introduction to Polars from R</h1>



<div id="what-is-polars" class="section level2">
<h2>What is Polars?</h2>
<p>Polars is <a href="https://duckdblabs.github.io/db-benchmark/">a
lightning fast</a> Data Frame library. Its embarrassingly parallel
execution, cache efficient algorithms and expressive API makes it
perfect for efficient data wrangling, data pipelines, snappy APIs, and
much more besides. Polars also supports “streaming mode” for
out-of-memory operations. This allows users to analyze datasets many
times larger than RAM.</p>
<p>The underlying computation engine is written in Rust and is built on
the Apache Arrow columnar memory format. It can be used in Rust or via
Python bindings. The <strong>polars</strong> R-package provides
equivalent bindings from R. To help distinguish the different language
implementations, we typically use a convention of referring to them with
prefixes: rust-polars, py-polars, r-polars, nodejs-polars, etc. But
within each language, the relevant library is always just called
<em>polars</em>.</p>
<p><strong>polars</strong> users can expect orders of magnitude(s)
improvement compared to <strong>dplyr</strong> for simple
transformations on datasets &gt;500Mb. The automatic Polars optimization
framework means that that this speed boost can be even greater for
complex queries that chain together many operations. Performance is
similar to that of <strong>data.table</strong>, although
<strong>polars</strong> supports additional functionality via its
relationship to the Apache Arrow memory model. For example, it can scan
multiple Parquet files and datasets and selectively import random
subsets without having to read all of the data.</p>
<p>Polars syntax is similar to that of Spark, but the workflow is
column-oriented rather than row-oriented. Since R is itself a
column-oriented language, this should immediately feel familiar to most
R users. Like Spark and modern SQL variants, Polars optimizes queries
for memory consumption and speed, so you don’t have to. However, unlike
Spark, Polars is natively multithreaded instead of multinoded. This
makes (r)polars much simpler to install and can be used as one would any
other R package.</p>
<p>This R port relies on the excellent <a href="https://github.com/extendr"><strong>extendr</strong></a> package,
which is the R equivalent to pyo3+maturin. <strong>extendr</strong> is
very convenient for calling Rust from R, and vice versa, and is what we
use to build the <strong>polars</strong> package. Once built, however,
<strong>polars</strong> has no other dependencies other than R itself.
This makes it very fast and lightweight to install, and so
<strong>polars</strong> can immediately be used to tackle your big (or
small!) data wrangling tasks.</p>
</div>
<div id="documentation-and-tutorials" class="section level2">
<h2>Documentation and tutorials</h2>
<p>Users can find detailed documentation for all objects, functions, and
methods on the Reference page of <a href="https://rpolars.github.io/">this website</a>. This documentation
can also be accessed from the R console using the typical <code>?</code>
syntax. For example, we will later use the <code>DataFrame()</code>
constructor function and apply the <code>groupby()</code> method to a
<code>DataFrame</code> object. The documentation for these can be
accessed by typing these commands:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>?DataFrame</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>?DataFrame_groupby</span></code></pre></div>
<p>The <a href="https://pola-rs.github.io/polars-book/user-guide/">Polars book</a>
offers a great introduction to the Polars data frame library, with a
very large number of examples in Python and Rust. The syntax and
expressions in the <code>polars</code> package for R are (deliberately)
as close to the Python implementation as possible, so you can always
refer to the <a href="https://pola-rs.github.io/polars-book/user-guide/">polars book</a>
for more ideas. Just remember to switch out any “.” (Python) for a “$”
(R) when chaining methods. For example, here are two equivalent lines of
code for some hypothetical dataset.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co"># Python</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>df.groupby(<span class="st">&quot;id&quot;</span>).mean()</span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="co"># R</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>df<span class="sc">$</span><span class="fu">groupby</span>(<span class="st">&quot;id&quot;</span>)<span class="sc">$</span><span class="fu">mean</span>()</span></code></pre></div>
</div>
<div id="series-and-dataframes" class="section level2">
<h2><code>Series</code> and <code>DataFrames</code></h2>
<p>In <code>polars</code> objects of class <code>Series</code> are
analogous to R vectors. Objects of class <code>DataFrame</code> are
analogous to R data frames. To convert R vectors and data frames to
Polars <code>Series</code> and <code>DataFrames</code>, we load the
library and use constructor functions with the <code>pl$</code> prefix.
This prefix is very important, as most of the <code>polars</code>
functions are made available via <code>pl$</code>:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="fu">library</span>(polars)</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>ser <span class="ot">=</span> pl<span class="sc">$</span><span class="fu">Series</span>((<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) <span class="sc">*</span> <span class="dv">5</span>)</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>ser</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="co">#&gt; polars Series: shape: (5,)</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="co">#&gt; Series: &#39;&#39; [f64]</span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a><span class="co">#&gt; [</span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a><span class="co">#&gt;  5.0</span></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a><span class="co">#&gt;  10.0</span></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a><span class="co">#&gt;  15.0</span></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a><span class="co">#&gt;  20.0</span></span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a><span class="co">#&gt;  25.0</span></span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a><span class="co">#&gt; ]</span></span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a></span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a>dat <span class="ot">=</span> pl<span class="sc">$</span><span class="fu">DataFrame</span>(mtcars)</span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a>dat</span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a><span class="co">#&gt; shape: (32, 11)</span></span>
<span id="cb4-18"><a href="#cb4-18" tabindex="-1"></a><span class="co">#&gt; ┌──────┬─────┬───────┬───────┬───┬─────┬─────┬──────┬──────┐</span></span>
<span id="cb4-19"><a href="#cb4-19" tabindex="-1"></a><span class="co">#&gt; │ mpg  ┆ cyl ┆ disp  ┆ hp    ┆ … ┆ vs  ┆ am  ┆ gear ┆ carb │</span></span>
<span id="cb4-20"><a href="#cb4-20" tabindex="-1"></a><span class="co">#&gt; │ ---  ┆ --- ┆ ---   ┆ ---   ┆   ┆ --- ┆ --- ┆ ---  ┆ ---  │</span></span>
<span id="cb4-21"><a href="#cb4-21" tabindex="-1"></a><span class="co">#&gt; │ f64  ┆ f64 ┆ f64   ┆ f64   ┆   ┆ f64 ┆ f64 ┆ f64  ┆ f64  │</span></span>
<span id="cb4-22"><a href="#cb4-22" tabindex="-1"></a><span class="co">#&gt; ╞══════╪═════╪═══════╪═══════╪═══╪═════╪═════╪══════╪══════╡</span></span>
<span id="cb4-23"><a href="#cb4-23" tabindex="-1"></a><span class="co">#&gt; │ 21.0 ┆ 6.0 ┆ 160.0 ┆ 110.0 ┆ … ┆ 0.0 ┆ 1.0 ┆ 4.0  ┆ 4.0  │</span></span>
<span id="cb4-24"><a href="#cb4-24" tabindex="-1"></a><span class="co">#&gt; │ 21.0 ┆ 6.0 ┆ 160.0 ┆ 110.0 ┆ … ┆ 0.0 ┆ 1.0 ┆ 4.0  ┆ 4.0  │</span></span>
<span id="cb4-25"><a href="#cb4-25" tabindex="-1"></a><span class="co">#&gt; │ 22.8 ┆ 4.0 ┆ 108.0 ┆ 93.0  ┆ … ┆ 1.0 ┆ 1.0 ┆ 4.0  ┆ 1.0  │</span></span>
<span id="cb4-26"><a href="#cb4-26" tabindex="-1"></a><span class="co">#&gt; │ 21.4 ┆ 6.0 ┆ 258.0 ┆ 110.0 ┆ … ┆ 1.0 ┆ 0.0 ┆ 3.0  ┆ 1.0  │</span></span>
<span id="cb4-27"><a href="#cb4-27" tabindex="-1"></a><span class="co">#&gt; │ …    ┆ …   ┆ …     ┆ …     ┆ … ┆ …   ┆ …   ┆ …    ┆ …    │</span></span>
<span id="cb4-28"><a href="#cb4-28" tabindex="-1"></a><span class="co">#&gt; │ 15.8 ┆ 8.0 ┆ 351.0 ┆ 264.0 ┆ … ┆ 0.0 ┆ 1.0 ┆ 5.0  ┆ 4.0  │</span></span>
<span id="cb4-29"><a href="#cb4-29" tabindex="-1"></a><span class="co">#&gt; │ 19.7 ┆ 6.0 ┆ 145.0 ┆ 175.0 ┆ … ┆ 0.0 ┆ 1.0 ┆ 5.0  ┆ 6.0  │</span></span>
<span id="cb4-30"><a href="#cb4-30" tabindex="-1"></a><span class="co">#&gt; │ 15.0 ┆ 8.0 ┆ 301.0 ┆ 335.0 ┆ … ┆ 0.0 ┆ 1.0 ┆ 5.0  ┆ 8.0  │</span></span>
<span id="cb4-31"><a href="#cb4-31" tabindex="-1"></a><span class="co">#&gt; │ 21.4 ┆ 4.0 ┆ 121.0 ┆ 109.0 ┆ … ┆ 1.0 ┆ 1.0 ┆ 4.0  ┆ 2.0  │</span></span>
<span id="cb4-32"><a href="#cb4-32" tabindex="-1"></a><span class="co">#&gt; └──────┴─────┴───────┴───────┴───┴─────┴─────┴──────┴──────┘</span></span></code></pre></div>
<p>Both Polars and R are column-orientated. So you can think of
<code>DataFrames</code> (data.frames) as being made up of a collection
of <code>Series</code> (vectors). In fact, you can create a new Polars
<code>DataFrame</code> as a mix of <code>Series</code> and/or regular R
vectors.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>pl<span class="sc">$</span><span class="fu">DataFrame</span>(</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>  <span class="at">a =</span> pl<span class="sc">$</span><span class="fu">Series</span>((<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) <span class="sc">*</span> <span class="dv">5</span>),</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>  <span class="at">b =</span> pl<span class="sc">$</span><span class="fu">Series</span>(letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]),</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>  <span class="at">c =</span> pl<span class="sc">$</span><span class="fu">Series</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>)),</span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>  <span class="at">d =</span> <span class="fu">c</span>(<span class="dv">15</span>, <span class="dv">14</span>, <span class="dv">13</span>, <span class="dv">12</span>, <span class="dv">11</span>),</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">1</span>),</span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>  <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a>)</span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a><span class="co">#&gt; shape: (5, 6)</span></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a><span class="co">#&gt; ┌──────┬─────┬─────┬──────┬────────────┬──────────────┐</span></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a><span class="co">#&gt; │ a    ┆ b   ┆ c   ┆ d    ┆ new_column ┆ new_column_1 │</span></span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a><span class="co">#&gt; │ ---  ┆ --- ┆ --- ┆ ---  ┆ ---        ┆ ---          │</span></span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a><span class="co">#&gt; │ f64  ┆ str ┆ f64 ┆ f64  ┆ f64        ┆ i32          │</span></span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a><span class="co">#&gt; ╞══════╪═════╪═════╪══════╪════════════╪══════════════╡</span></span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a><span class="co">#&gt; │ 5.0  ┆ a   ┆ 1.0 ┆ 15.0 ┆ 5.0        ┆ 1            │</span></span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a><span class="co">#&gt; │ 10.0 ┆ b   ┆ 2.0 ┆ 14.0 ┆ 4.0        ┆ 2            │</span></span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a><span class="co">#&gt; │ 15.0 ┆ c   ┆ 3.0 ┆ 13.0 ┆ 3.0        ┆ 3            │</span></span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a><span class="co">#&gt; │ 20.0 ┆ d   ┆ 4.0 ┆ 12.0 ┆ 2.0        ┆ 4            │</span></span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a><span class="co">#&gt; │ 25.0 ┆ e   ┆ 5.0 ┆ 11.0 ┆ 1.0        ┆ 5            │</span></span>
<span id="cb5-20"><a href="#cb5-20" tabindex="-1"></a><span class="co">#&gt; └──────┴─────┴─────┴──────┴────────────┴──────────────┘</span></span></code></pre></div>
<p><code>Series</code> and <code>DataFrame</code> can be operated on
using many standard R functions. For example:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="co"># Series</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="fu">length</span>(ser)</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="co">#&gt; [1] 5</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="fu">max</span>(ser)</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a><span class="co">#&gt; [1] 25</span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a><span class="co"># DataFrame</span></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a>dat[<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">12</span>), <span class="fu">c</span>(<span class="st">&quot;mpg&quot;</span>, <span class="st">&quot;hp&quot;</span>)]</span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a><span class="co">#&gt; shape: (4, 2)</span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a><span class="co">#&gt; ┌──────┬───────┐</span></span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a><span class="co">#&gt; │ mpg  ┆ hp    │</span></span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a><span class="co">#&gt; │ ---  ┆ ---   │</span></span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a><span class="co">#&gt; │ f64  ┆ f64   │</span></span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a><span class="co">#&gt; ╞══════╪═══════╡</span></span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a><span class="co">#&gt; │ 21.0 ┆ 110.0 │</span></span>
<span id="cb6-17"><a href="#cb6-17" tabindex="-1"></a><span class="co">#&gt; │ 21.0 ┆ 110.0 │</span></span>
<span id="cb6-18"><a href="#cb6-18" tabindex="-1"></a><span class="co">#&gt; │ 22.8 ┆ 93.0  │</span></span>
<span id="cb6-19"><a href="#cb6-19" tabindex="-1"></a><span class="co">#&gt; │ 16.4 ┆ 180.0 │</span></span>
<span id="cb6-20"><a href="#cb6-20" tabindex="-1"></a><span class="co">#&gt; └──────┴───────┘</span></span>
<span id="cb6-21"><a href="#cb6-21" tabindex="-1"></a></span>
<span id="cb6-22"><a href="#cb6-22" tabindex="-1"></a><span class="fu">names</span>(dat)</span>
<span id="cb6-23"><a href="#cb6-23" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;mpg&quot;  &quot;cyl&quot;  &quot;disp&quot; &quot;hp&quot;   &quot;drat&quot; &quot;wt&quot;   &quot;qsec&quot; &quot;vs&quot;   &quot;am&quot;   &quot;gear&quot;</span></span>
<span id="cb6-24"><a href="#cb6-24" tabindex="-1"></a><span class="co">#&gt; [11] &quot;carb&quot;</span></span>
<span id="cb6-25"><a href="#cb6-25" tabindex="-1"></a></span>
<span id="cb6-26"><a href="#cb6-26" tabindex="-1"></a><span class="fu">dim</span>(dat)</span>
<span id="cb6-27"><a href="#cb6-27" tabindex="-1"></a><span class="co">#&gt; [1] 32 11</span></span>
<span id="cb6-28"><a href="#cb6-28" tabindex="-1"></a></span>
<span id="cb6-29"><a href="#cb6-29" tabindex="-1"></a><span class="fu">head</span>(dat, <span class="at">n =</span> <span class="dv">2</span>)</span>
<span id="cb6-30"><a href="#cb6-30" tabindex="-1"></a><span class="co">#&gt; shape: (2, 11)</span></span>
<span id="cb6-31"><a href="#cb6-31" tabindex="-1"></a><span class="co">#&gt; ┌──────┬─────┬───────┬───────┬───┬─────┬─────┬──────┬──────┐</span></span>
<span id="cb6-32"><a href="#cb6-32" tabindex="-1"></a><span class="co">#&gt; │ mpg  ┆ cyl ┆ disp  ┆ hp    ┆ … ┆ vs  ┆ am  ┆ gear ┆ carb │</span></span>
<span id="cb6-33"><a href="#cb6-33" tabindex="-1"></a><span class="co">#&gt; │ ---  ┆ --- ┆ ---   ┆ ---   ┆   ┆ --- ┆ --- ┆ ---  ┆ ---  │</span></span>
<span id="cb6-34"><a href="#cb6-34" tabindex="-1"></a><span class="co">#&gt; │ f64  ┆ f64 ┆ f64   ┆ f64   ┆   ┆ f64 ┆ f64 ┆ f64  ┆ f64  │</span></span>
<span id="cb6-35"><a href="#cb6-35" tabindex="-1"></a><span class="co">#&gt; ╞══════╪═════╪═══════╪═══════╪═══╪═════╪═════╪══════╪══════╡</span></span>
<span id="cb6-36"><a href="#cb6-36" tabindex="-1"></a><span class="co">#&gt; │ 21.0 ┆ 6.0 ┆ 160.0 ┆ 110.0 ┆ … ┆ 0.0 ┆ 1.0 ┆ 4.0  ┆ 4.0  │</span></span>
<span id="cb6-37"><a href="#cb6-37" tabindex="-1"></a><span class="co">#&gt; │ 21.0 ┆ 6.0 ┆ 160.0 ┆ 110.0 ┆ … ┆ 0.0 ┆ 1.0 ┆ 4.0  ┆ 4.0  │</span></span>
<span id="cb6-38"><a href="#cb6-38" tabindex="-1"></a><span class="co">#&gt; └──────┴─────┴───────┴───────┴───┴─────┴─────┴──────┴──────┘</span></span></code></pre></div>
</div>
<div id="methods-and-pipelines" class="section level2">
<h2>Methods and pipelines</h2>
<p>Although some simple R functions work out of the box on
<strong>polars</strong> objects, the full power of Polars is realized
via <em>methods</em>. Polars methods are accessed using the
<code>$</code> syntax. For example, to convert Polars
<code>Series</code> and <code>DataFrames</code> back to standard R
objects, we use the <code>$to_vector()</code> and
<code>$to_data_frame()</code> methods:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>ser<span class="sc">$</span><span class="fu">to_vector</span>()</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="co">#&gt; [1]  5 10 15 20 25</span></span></code></pre></div>
<p>There are numerous methods designed to accomplish various tasks:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>ser<span class="sc">$</span><span class="fu">max</span>()</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="co">#&gt; [1] 25</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>dat<span class="sc">$</span><span class="fu">slice</span>(<span class="at">offset =</span> <span class="dv">2</span>, <span class="at">length =</span> <span class="dv">3</span>)</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="co">#&gt; shape: (3, 11)</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a><span class="co">#&gt; ┌──────┬─────┬───────┬───────┬───┬─────┬─────┬──────┬──────┐</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="co">#&gt; │ mpg  ┆ cyl ┆ disp  ┆ hp    ┆ … ┆ vs  ┆ am  ┆ gear ┆ carb │</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a><span class="co">#&gt; │ ---  ┆ --- ┆ ---   ┆ ---   ┆   ┆ --- ┆ --- ┆ ---  ┆ ---  │</span></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a><span class="co">#&gt; │ f64  ┆ f64 ┆ f64   ┆ f64   ┆   ┆ f64 ┆ f64 ┆ f64  ┆ f64  │</span></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a><span class="co">#&gt; ╞══════╪═════╪═══════╪═══════╪═══╪═════╪═════╪══════╪══════╡</span></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a><span class="co">#&gt; │ 22.8 ┆ 4.0 ┆ 108.0 ┆ 93.0  ┆ … ┆ 1.0 ┆ 1.0 ┆ 4.0  ┆ 1.0  │</span></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a><span class="co">#&gt; │ 21.4 ┆ 6.0 ┆ 258.0 ┆ 110.0 ┆ … ┆ 1.0 ┆ 0.0 ┆ 3.0  ┆ 1.0  │</span></span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a><span class="co">#&gt; │ 18.7 ┆ 8.0 ┆ 360.0 ┆ 175.0 ┆ … ┆ 0.0 ┆ 0.0 ┆ 3.0  ┆ 2.0  │</span></span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a><span class="co">#&gt; └──────┴─────┴───────┴───────┴───┴─────┴─────┴──────┴──────┘</span></span></code></pre></div>
<p>One advantage of using methods is that many more operations are
possible on Polars objects using methods than through base R
functions.</p>
<p>A second advantage is <em>Methods Chaining</em>, a core part of the
Polars workflow. If you are coming from one of the other popular data
wrangling libraries in R, then you probably already have an innate sense
of what this means. For instance,</p>
<ul>
<li>In <strong>dplyr</strong> we use a pipe operator,
e.g. <code>dat |&gt; filter(...) |&gt; select(...)</code></li>
<li>In <strong>data.table</strong> we use its indexing syntax,
e.g. <code>DT[i, j, by][...]</code></li>
<li>Etc.</li>
</ul>
<p>In <strong>polars</strong> our method chaining syntax takes the form
<code>object$m1()$m2()</code>, where <code>object</code> is our data
object, and <code>m1()</code> and <code>m2()</code> are appropriate
methods, like subsetting or aggregation expressions.</p>
<p>This might all seem a little abstract, so let’s walk through some
quick examples to help make things concrete. We continue with the
<code>mtcars</code> dataset that we coerced to a <code>DataFrame</code>
in the introduction.<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></p>
<p>To start, say we compute the maximum value in each column. We can use
the <code>max()</code> method:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>dat<span class="sc">$</span><span class="fu">max</span>()</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="co">#&gt; shape: (1, 11)</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="co">#&gt; ┌──────┬─────┬───────┬───────┬───┬─────┬─────┬──────┬──────┐</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="co">#&gt; │ mpg  ┆ cyl ┆ disp  ┆ hp    ┆ … ┆ vs  ┆ am  ┆ gear ┆ carb │</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a><span class="co">#&gt; │ ---  ┆ --- ┆ ---   ┆ ---   ┆   ┆ --- ┆ --- ┆ ---  ┆ ---  │</span></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a><span class="co">#&gt; │ f64  ┆ f64 ┆ f64   ┆ f64   ┆   ┆ f64 ┆ f64 ┆ f64  ┆ f64  │</span></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a><span class="co">#&gt; ╞══════╪═════╪═══════╪═══════╪═══╪═════╪═════╪══════╪══════╡</span></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a><span class="co">#&gt; │ 33.9 ┆ 8.0 ┆ 472.0 ┆ 335.0 ┆ … ┆ 1.0 ┆ 1.0 ┆ 5.0  ┆ 8.0  │</span></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a><span class="co">#&gt; └──────┴─────┴───────┴───────┴───┴─────┴─────┴──────┴──────┘</span></span></code></pre></div>
<p>Now, we first use the <code>$tail</code> method to select the last 10
rows of the dataset, and then use the <code>$max</code> method to
compute the maximums in those 10 rows:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>dat<span class="sc">$</span><span class="fu">tail</span>(<span class="dv">10</span>)<span class="sc">$</span><span class="fu">max</span>()</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="co">#&gt; shape: (1, 11)</span></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="co">#&gt; ┌──────┬─────┬───────┬───────┬───┬─────┬─────┬──────┬──────┐</span></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a><span class="co">#&gt; │ mpg  ┆ cyl ┆ disp  ┆ hp    ┆ … ┆ vs  ┆ am  ┆ gear ┆ carb │</span></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a><span class="co">#&gt; │ ---  ┆ --- ┆ ---   ┆ ---   ┆   ┆ --- ┆ --- ┆ ---  ┆ ---  │</span></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a><span class="co">#&gt; │ f64  ┆ f64 ┆ f64   ┆ f64   ┆   ┆ f64 ┆ f64 ┆ f64  ┆ f64  │</span></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a><span class="co">#&gt; ╞══════╪═════╪═══════╪═══════╪═══╪═════╪═════╪══════╪══════╡</span></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a><span class="co">#&gt; │ 30.4 ┆ 8.0 ┆ 400.0 ┆ 335.0 ┆ … ┆ 1.0 ┆ 1.0 ┆ 5.0  ┆ 8.0  │</span></span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a><span class="co">#&gt; └──────┴─────┴───────┴───────┴───┴─────┴─────┴──────┴──────┘</span></span></code></pre></div>
<p>Finally, we convert the result to a standard R data frame:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>dat<span class="sc">$</span><span class="fu">tail</span>(<span class="dv">10</span>)<span class="sc">$</span><span class="fu">max</span>()<span class="sc">$</span><span class="fu">to_data_frame</span>()</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="co">#&gt;    mpg cyl disp  hp drat    wt qsec vs am gear carb</span></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a><span class="co">#&gt; 1 30.4   8  400 335 4.43 3.845 18.9  1  1    5    8</span></span></code></pre></div>
<p>Below, we will introduce several other methods, including
<code>$select</code>, <code>$filter</code>, and <code>$groupby</code>
which allow us to do powerful data manipulations easily. To give you a
small taste, we now take group-wise means:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>dat<span class="sc">$</span><span class="fu">groupby</span>(<span class="st">&quot;cyl&quot;</span>)<span class="sc">$</span><span class="fu">mean</span>()</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="co">#&gt; shape: (3, 11)</span></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="co">#&gt; ┌─────┬───────────┬────────────┬────────────┬───┬──────────┬──────────┬──────────┬──────────┐</span></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a><span class="co">#&gt; │ cyl ┆ mpg       ┆ disp       ┆ hp         ┆ … ┆ vs       ┆ am       ┆ gear     ┆ carb     │</span></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a><span class="co">#&gt; │ --- ┆ ---       ┆ ---        ┆ ---        ┆   ┆ ---      ┆ ---      ┆ ---      ┆ ---      │</span></span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a><span class="co">#&gt; │ f64 ┆ f64       ┆ f64        ┆ f64        ┆   ┆ f64      ┆ f64      ┆ f64      ┆ f64      │</span></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a><span class="co">#&gt; ╞═════╪═══════════╪════════════╪════════════╪═══╪══════════╪══════════╪══════════╪══════════╡</span></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a><span class="co">#&gt; │ 4.0 ┆ 26.663636 ┆ 105.136364 ┆ 82.636364  ┆ … ┆ 0.909091 ┆ 0.727273 ┆ 4.090909 ┆ 1.545455 │</span></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a><span class="co">#&gt; │ 8.0 ┆ 15.1      ┆ 353.1      ┆ 209.214286 ┆ … ┆ 0.0      ┆ 0.142857 ┆ 3.285714 ┆ 3.5      │</span></span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a><span class="co">#&gt; │ 6.0 ┆ 19.742857 ┆ 183.314286 ┆ 122.285714 ┆ … ┆ 0.571429 ┆ 0.428571 ┆ 3.857143 ┆ 3.428571 │</span></span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a><span class="co">#&gt; └─────┴───────────┴────────────┴────────────┴───┴──────────┴──────────┴──────────┴──────────┘</span></span></code></pre></div>
</div>
<div id="subset" class="section level2">
<h2>Subset</h2>
<p>We can now start chaining together various methods (expressions) to
manipulate it in different ways. For example, we can subset the data by
rows (<a href="https://rpolars.github.io/reference/DataFrame_filter/"><code>filter()</code></a>)
and also columns (<a href="https://rpolars.github.io/reference/DataFrame_select/"><code>select()</code></a>):</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>dat<span class="sc">$</span><span class="fu">filter</span>(pl<span class="sc">$</span><span class="fu">col</span>(<span class="st">&quot;cyl&quot;</span>) <span class="sc">==</span> <span class="dv">6</span>)</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="co">#&gt; shape: (7, 11)</span></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a><span class="co">#&gt; ┌──────┬─────┬───────┬───────┬───┬─────┬─────┬──────┬──────┐</span></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a><span class="co">#&gt; │ mpg  ┆ cyl ┆ disp  ┆ hp    ┆ … ┆ vs  ┆ am  ┆ gear ┆ carb │</span></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a><span class="co">#&gt; │ ---  ┆ --- ┆ ---   ┆ ---   ┆   ┆ --- ┆ --- ┆ ---  ┆ ---  │</span></span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a><span class="co">#&gt; │ f64  ┆ f64 ┆ f64   ┆ f64   ┆   ┆ f64 ┆ f64 ┆ f64  ┆ f64  │</span></span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a><span class="co">#&gt; ╞══════╪═════╪═══════╪═══════╪═══╪═════╪═════╪══════╪══════╡</span></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a><span class="co">#&gt; │ 21.0 ┆ 6.0 ┆ 160.0 ┆ 110.0 ┆ … ┆ 0.0 ┆ 1.0 ┆ 4.0  ┆ 4.0  │</span></span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a><span class="co">#&gt; │ 21.0 ┆ 6.0 ┆ 160.0 ┆ 110.0 ┆ … ┆ 0.0 ┆ 1.0 ┆ 4.0  ┆ 4.0  │</span></span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a><span class="co">#&gt; │ 21.4 ┆ 6.0 ┆ 258.0 ┆ 110.0 ┆ … ┆ 1.0 ┆ 0.0 ┆ 3.0  ┆ 1.0  │</span></span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a><span class="co">#&gt; │ 18.1 ┆ 6.0 ┆ 225.0 ┆ 105.0 ┆ … ┆ 1.0 ┆ 0.0 ┆ 3.0  ┆ 1.0  │</span></span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a><span class="co">#&gt; │ 19.2 ┆ 6.0 ┆ 167.6 ┆ 123.0 ┆ … ┆ 1.0 ┆ 0.0 ┆ 4.0  ┆ 4.0  │</span></span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a><span class="co">#&gt; │ 17.8 ┆ 6.0 ┆ 167.6 ┆ 123.0 ┆ … ┆ 1.0 ┆ 0.0 ┆ 4.0  ┆ 4.0  │</span></span>
<span id="cb13-14"><a href="#cb13-14" tabindex="-1"></a><span class="co">#&gt; │ 19.7 ┆ 6.0 ┆ 145.0 ┆ 175.0 ┆ … ┆ 0.0 ┆ 1.0 ┆ 5.0  ┆ 6.0  │</span></span>
<span id="cb13-15"><a href="#cb13-15" tabindex="-1"></a><span class="co">#&gt; └──────┴─────┴───────┴───────┴───┴─────┴─────┴──────┴──────┘</span></span>
<span id="cb13-16"><a href="#cb13-16" tabindex="-1"></a></span>
<span id="cb13-17"><a href="#cb13-17" tabindex="-1"></a>dat<span class="sc">$</span><span class="fu">filter</span>(pl<span class="sc">$</span><span class="fu">col</span>(<span class="st">&quot;cyl&quot;</span>) <span class="sc">==</span> <span class="dv">6</span> <span class="sc">&amp;</span> pl<span class="sc">$</span><span class="fu">col</span>(<span class="st">&quot;am&quot;</span>) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb13-18"><a href="#cb13-18" tabindex="-1"></a><span class="co">#&gt; shape: (3, 11)</span></span>
<span id="cb13-19"><a href="#cb13-19" tabindex="-1"></a><span class="co">#&gt; ┌──────┬─────┬───────┬───────┬───┬─────┬─────┬──────┬──────┐</span></span>
<span id="cb13-20"><a href="#cb13-20" tabindex="-1"></a><span class="co">#&gt; │ mpg  ┆ cyl ┆ disp  ┆ hp    ┆ … ┆ vs  ┆ am  ┆ gear ┆ carb │</span></span>
<span id="cb13-21"><a href="#cb13-21" tabindex="-1"></a><span class="co">#&gt; │ ---  ┆ --- ┆ ---   ┆ ---   ┆   ┆ --- ┆ --- ┆ ---  ┆ ---  │</span></span>
<span id="cb13-22"><a href="#cb13-22" tabindex="-1"></a><span class="co">#&gt; │ f64  ┆ f64 ┆ f64   ┆ f64   ┆   ┆ f64 ┆ f64 ┆ f64  ┆ f64  │</span></span>
<span id="cb13-23"><a href="#cb13-23" tabindex="-1"></a><span class="co">#&gt; ╞══════╪═════╪═══════╪═══════╪═══╪═════╪═════╪══════╪══════╡</span></span>
<span id="cb13-24"><a href="#cb13-24" tabindex="-1"></a><span class="co">#&gt; │ 21.0 ┆ 6.0 ┆ 160.0 ┆ 110.0 ┆ … ┆ 0.0 ┆ 1.0 ┆ 4.0  ┆ 4.0  │</span></span>
<span id="cb13-25"><a href="#cb13-25" tabindex="-1"></a><span class="co">#&gt; │ 21.0 ┆ 6.0 ┆ 160.0 ┆ 110.0 ┆ … ┆ 0.0 ┆ 1.0 ┆ 4.0  ┆ 4.0  │</span></span>
<span id="cb13-26"><a href="#cb13-26" tabindex="-1"></a><span class="co">#&gt; │ 19.7 ┆ 6.0 ┆ 145.0 ┆ 175.0 ┆ … ┆ 0.0 ┆ 1.0 ┆ 5.0  ┆ 6.0  │</span></span>
<span id="cb13-27"><a href="#cb13-27" tabindex="-1"></a><span class="co">#&gt; └──────┴─────┴───────┴───────┴───┴─────┴─────┴──────┴──────┘</span></span>
<span id="cb13-28"><a href="#cb13-28" tabindex="-1"></a></span>
<span id="cb13-29"><a href="#cb13-29" tabindex="-1"></a>dat<span class="sc">$</span><span class="fu">select</span>(pl<span class="sc">$</span><span class="fu">col</span>(<span class="fu">c</span>(<span class="st">&quot;mpg&quot;</span>, <span class="st">&quot;hp&quot;</span>)))</span>
<span id="cb13-30"><a href="#cb13-30" tabindex="-1"></a><span class="co">#&gt; shape: (32, 2)</span></span>
<span id="cb13-31"><a href="#cb13-31" tabindex="-1"></a><span class="co">#&gt; ┌──────┬───────┐</span></span>
<span id="cb13-32"><a href="#cb13-32" tabindex="-1"></a><span class="co">#&gt; │ mpg  ┆ hp    │</span></span>
<span id="cb13-33"><a href="#cb13-33" tabindex="-1"></a><span class="co">#&gt; │ ---  ┆ ---   │</span></span>
<span id="cb13-34"><a href="#cb13-34" tabindex="-1"></a><span class="co">#&gt; │ f64  ┆ f64   │</span></span>
<span id="cb13-35"><a href="#cb13-35" tabindex="-1"></a><span class="co">#&gt; ╞══════╪═══════╡</span></span>
<span id="cb13-36"><a href="#cb13-36" tabindex="-1"></a><span class="co">#&gt; │ 21.0 ┆ 110.0 │</span></span>
<span id="cb13-37"><a href="#cb13-37" tabindex="-1"></a><span class="co">#&gt; │ 21.0 ┆ 110.0 │</span></span>
<span id="cb13-38"><a href="#cb13-38" tabindex="-1"></a><span class="co">#&gt; │ 22.8 ┆ 93.0  │</span></span>
<span id="cb13-39"><a href="#cb13-39" tabindex="-1"></a><span class="co">#&gt; │ 21.4 ┆ 110.0 │</span></span>
<span id="cb13-40"><a href="#cb13-40" tabindex="-1"></a><span class="co">#&gt; │ …    ┆ …     │</span></span>
<span id="cb13-41"><a href="#cb13-41" tabindex="-1"></a><span class="co">#&gt; │ 15.8 ┆ 264.0 │</span></span>
<span id="cb13-42"><a href="#cb13-42" tabindex="-1"></a><span class="co">#&gt; │ 19.7 ┆ 175.0 │</span></span>
<span id="cb13-43"><a href="#cb13-43" tabindex="-1"></a><span class="co">#&gt; │ 15.0 ┆ 335.0 │</span></span>
<span id="cb13-44"><a href="#cb13-44" tabindex="-1"></a><span class="co">#&gt; │ 21.4 ┆ 109.0 │</span></span>
<span id="cb13-45"><a href="#cb13-45" tabindex="-1"></a><span class="co">#&gt; └──────┴───────┘</span></span></code></pre></div>
<p>Of course, we can chain those methods to create a pipeline:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>dat<span class="sc">$</span><span class="fu">filter</span>(</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>  pl<span class="sc">$</span><span class="fu">col</span>(<span class="st">&quot;cyl&quot;</span>) <span class="sc">==</span> <span class="dv">6</span></span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>)<span class="sc">$</span><span class="fu">select</span>(</span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a>  pl<span class="sc">$</span><span class="fu">col</span>(<span class="fu">c</span>(<span class="st">&quot;mpg&quot;</span>, <span class="st">&quot;hp&quot;</span>, <span class="st">&quot;cyl&quot;</span>))</span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>)</span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a><span class="co">#&gt; shape: (7, 3)</span></span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a><span class="co">#&gt; ┌──────┬───────┬─────┐</span></span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a><span class="co">#&gt; │ mpg  ┆ hp    ┆ cyl │</span></span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a><span class="co">#&gt; │ ---  ┆ ---   ┆ --- │</span></span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a><span class="co">#&gt; │ f64  ┆ f64   ┆ f64 │</span></span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a><span class="co">#&gt; ╞══════╪═══════╪═════╡</span></span>
<span id="cb14-12"><a href="#cb14-12" tabindex="-1"></a><span class="co">#&gt; │ 21.0 ┆ 110.0 ┆ 6.0 │</span></span>
<span id="cb14-13"><a href="#cb14-13" tabindex="-1"></a><span class="co">#&gt; │ 21.0 ┆ 110.0 ┆ 6.0 │</span></span>
<span id="cb14-14"><a href="#cb14-14" tabindex="-1"></a><span class="co">#&gt; │ 21.4 ┆ 110.0 ┆ 6.0 │</span></span>
<span id="cb14-15"><a href="#cb14-15" tabindex="-1"></a><span class="co">#&gt; │ 18.1 ┆ 105.0 ┆ 6.0 │</span></span>
<span id="cb14-16"><a href="#cb14-16" tabindex="-1"></a><span class="co">#&gt; │ 19.2 ┆ 123.0 ┆ 6.0 │</span></span>
<span id="cb14-17"><a href="#cb14-17" tabindex="-1"></a><span class="co">#&gt; │ 17.8 ┆ 123.0 ┆ 6.0 │</span></span>
<span id="cb14-18"><a href="#cb14-18" tabindex="-1"></a><span class="co">#&gt; │ 19.7 ┆ 175.0 ┆ 6.0 │</span></span>
<span id="cb14-19"><a href="#cb14-19" tabindex="-1"></a><span class="co">#&gt; └──────┴───────┴─────┘</span></span></code></pre></div>
</div>
<div id="aggregate-and-modify" class="section level2">
<h2>Aggregate and modify</h2>
<p>The <code>select()</code> method that we introduced above also
supports data modification, so you can simultaneously transform it while
you are subsetting. However, the result will exclude any columns that
weren’t specified as part of the expression. To modify or add some
columns—whilst preserving all others in the dataset—it is therefore
better to use the <a href="https://rpolars.github.io/reference/DataFrame_with_columns/"><code>with_columns()</code></a>
method. This next code chunk is equivalent to
<code>mtcars |&gt; dplyr::mutate(sum_mpg=sum(mpg), sum_hp=sum(hp), .by = cyl)</code>.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="co"># Add the grouped sums of some selected columns.</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>dat<span class="sc">$</span><span class="fu">with_columns</span>(</span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a>  pl<span class="sc">$</span><span class="fu">col</span>(<span class="st">&quot;mpg&quot;</span>)<span class="sc">$</span><span class="fu">sum</span>()<span class="sc">$</span><span class="fu">over</span>(<span class="st">&quot;cyl&quot;</span>)<span class="sc">$</span><span class="fu">alias</span>(<span class="st">&quot;sum_mpg&quot;</span>),</span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a>  pl<span class="sc">$</span><span class="fu">col</span>(<span class="st">&quot;hp&quot;</span>)<span class="sc">$</span><span class="fu">sum</span>()<span class="sc">$</span><span class="fu">over</span>(<span class="st">&quot;cyl&quot;</span>)<span class="sc">$</span><span class="fu">alias</span>(<span class="st">&quot;sum_hp&quot;</span>)</span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a>)</span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a><span class="co">#&gt; shape: (32, 13)</span></span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a><span class="co">#&gt; ┌──────┬─────┬───────┬───────┬───┬──────┬──────┬─────────┬────────┐</span></span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a><span class="co">#&gt; │ mpg  ┆ cyl ┆ disp  ┆ hp    ┆ … ┆ gear ┆ carb ┆ sum_mpg ┆ sum_hp │</span></span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a><span class="co">#&gt; │ ---  ┆ --- ┆ ---   ┆ ---   ┆   ┆ ---  ┆ ---  ┆ ---     ┆ ---    │</span></span>
<span id="cb15-10"><a href="#cb15-10" tabindex="-1"></a><span class="co">#&gt; │ f64  ┆ f64 ┆ f64   ┆ f64   ┆   ┆ f64  ┆ f64  ┆ f64     ┆ f64    │</span></span>
<span id="cb15-11"><a href="#cb15-11" tabindex="-1"></a><span class="co">#&gt; ╞══════╪═════╪═══════╪═══════╪═══╪══════╪══════╪═════════╪════════╡</span></span>
<span id="cb15-12"><a href="#cb15-12" tabindex="-1"></a><span class="co">#&gt; │ 21.0 ┆ 6.0 ┆ 160.0 ┆ 110.0 ┆ … ┆ 4.0  ┆ 4.0  ┆ 138.2   ┆ 856.0  │</span></span>
<span id="cb15-13"><a href="#cb15-13" tabindex="-1"></a><span class="co">#&gt; │ 21.0 ┆ 6.0 ┆ 160.0 ┆ 110.0 ┆ … ┆ 4.0  ┆ 4.0  ┆ 138.2   ┆ 856.0  │</span></span>
<span id="cb15-14"><a href="#cb15-14" tabindex="-1"></a><span class="co">#&gt; │ 22.8 ┆ 4.0 ┆ 108.0 ┆ 93.0  ┆ … ┆ 4.0  ┆ 1.0  ┆ 293.3   ┆ 909.0  │</span></span>
<span id="cb15-15"><a href="#cb15-15" tabindex="-1"></a><span class="co">#&gt; │ 21.4 ┆ 6.0 ┆ 258.0 ┆ 110.0 ┆ … ┆ 3.0  ┆ 1.0  ┆ 138.2   ┆ 856.0  │</span></span>
<span id="cb15-16"><a href="#cb15-16" tabindex="-1"></a><span class="co">#&gt; │ …    ┆ …   ┆ …     ┆ …     ┆ … ┆ …    ┆ …    ┆ …       ┆ …      │</span></span>
<span id="cb15-17"><a href="#cb15-17" tabindex="-1"></a><span class="co">#&gt; │ 15.8 ┆ 8.0 ┆ 351.0 ┆ 264.0 ┆ … ┆ 5.0  ┆ 4.0  ┆ 211.4   ┆ 2929.0 │</span></span>
<span id="cb15-18"><a href="#cb15-18" tabindex="-1"></a><span class="co">#&gt; │ 19.7 ┆ 6.0 ┆ 145.0 ┆ 175.0 ┆ … ┆ 5.0  ┆ 6.0  ┆ 138.2   ┆ 856.0  │</span></span>
<span id="cb15-19"><a href="#cb15-19" tabindex="-1"></a><span class="co">#&gt; │ 15.0 ┆ 8.0 ┆ 301.0 ┆ 335.0 ┆ … ┆ 5.0  ┆ 8.0  ┆ 211.4   ┆ 2929.0 │</span></span>
<span id="cb15-20"><a href="#cb15-20" tabindex="-1"></a><span class="co">#&gt; │ 21.4 ┆ 4.0 ┆ 121.0 ┆ 109.0 ┆ … ┆ 4.0  ┆ 2.0  ┆ 293.3   ┆ 909.0  │</span></span>
<span id="cb15-21"><a href="#cb15-21" tabindex="-1"></a><span class="co">#&gt; └──────┴─────┴───────┴───────┴───┴──────┴──────┴─────────┴────────┘</span></span></code></pre></div>
<p>For what it’s worth, the previous query could have been written more
concisely as:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>dat<span class="sc">$</span><span class="fu">with_columns</span>(</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>  pl<span class="sc">$</span><span class="fu">col</span>(<span class="fu">c</span>(<span class="st">&quot;mpg&quot;</span>, <span class="st">&quot;hp&quot;</span>))<span class="sc">$</span><span class="fu">sum</span>()<span class="sc">$</span><span class="fu">over</span>(<span class="st">&quot;cyl&quot;</span>)<span class="sc">$</span><span class="fu">prefix</span>(<span class="st">&quot;sum_&quot;</span>)</span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a>)</span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a><span class="co">#&gt; shape: (32, 13)</span></span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a><span class="co">#&gt; ┌──────┬─────┬───────┬───────┬───┬──────┬──────┬─────────┬────────┐</span></span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a><span class="co">#&gt; │ mpg  ┆ cyl ┆ disp  ┆ hp    ┆ … ┆ gear ┆ carb ┆ sum_mpg ┆ sum_hp │</span></span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a><span class="co">#&gt; │ ---  ┆ --- ┆ ---   ┆ ---   ┆   ┆ ---  ┆ ---  ┆ ---     ┆ ---    │</span></span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a><span class="co">#&gt; │ f64  ┆ f64 ┆ f64   ┆ f64   ┆   ┆ f64  ┆ f64  ┆ f64     ┆ f64    │</span></span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a><span class="co">#&gt; ╞══════╪═════╪═══════╪═══════╪═══╪══════╪══════╪═════════╪════════╡</span></span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a><span class="co">#&gt; │ 21.0 ┆ 6.0 ┆ 160.0 ┆ 110.0 ┆ … ┆ 4.0  ┆ 4.0  ┆ 138.2   ┆ 856.0  │</span></span>
<span id="cb16-11"><a href="#cb16-11" tabindex="-1"></a><span class="co">#&gt; │ 21.0 ┆ 6.0 ┆ 160.0 ┆ 110.0 ┆ … ┆ 4.0  ┆ 4.0  ┆ 138.2   ┆ 856.0  │</span></span>
<span id="cb16-12"><a href="#cb16-12" tabindex="-1"></a><span class="co">#&gt; │ 22.8 ┆ 4.0 ┆ 108.0 ┆ 93.0  ┆ … ┆ 4.0  ┆ 1.0  ┆ 293.3   ┆ 909.0  │</span></span>
<span id="cb16-13"><a href="#cb16-13" tabindex="-1"></a><span class="co">#&gt; │ 21.4 ┆ 6.0 ┆ 258.0 ┆ 110.0 ┆ … ┆ 3.0  ┆ 1.0  ┆ 138.2   ┆ 856.0  │</span></span>
<span id="cb16-14"><a href="#cb16-14" tabindex="-1"></a><span class="co">#&gt; │ …    ┆ …   ┆ …     ┆ …     ┆ … ┆ …    ┆ …    ┆ …       ┆ …      │</span></span>
<span id="cb16-15"><a href="#cb16-15" tabindex="-1"></a><span class="co">#&gt; │ 15.8 ┆ 8.0 ┆ 351.0 ┆ 264.0 ┆ … ┆ 5.0  ┆ 4.0  ┆ 211.4   ┆ 2929.0 │</span></span>
<span id="cb16-16"><a href="#cb16-16" tabindex="-1"></a><span class="co">#&gt; │ 19.7 ┆ 6.0 ┆ 145.0 ┆ 175.0 ┆ … ┆ 5.0  ┆ 6.0  ┆ 138.2   ┆ 856.0  │</span></span>
<span id="cb16-17"><a href="#cb16-17" tabindex="-1"></a><span class="co">#&gt; │ 15.0 ┆ 8.0 ┆ 301.0 ┆ 335.0 ┆ … ┆ 5.0  ┆ 8.0  ┆ 211.4   ┆ 2929.0 │</span></span>
<span id="cb16-18"><a href="#cb16-18" tabindex="-1"></a><span class="co">#&gt; │ 21.4 ┆ 4.0 ┆ 121.0 ┆ 109.0 ┆ … ┆ 4.0  ┆ 2.0  ┆ 293.3   ┆ 909.0  │</span></span>
<span id="cb16-19"><a href="#cb16-19" tabindex="-1"></a><span class="co">#&gt; └──────┴─────┴───────┴───────┴───┴──────┴──────┴─────────┴────────┘</span></span></code></pre></div>
<p>Similarly, here’s how we could have aggregated (i.e., collapsed) the
dataset by groups instead of modifying them. We need simply invoke the
<code>groupby()</code> and <a href="https://rpolars.github.io/reference/Expr_agg_groups/"><code>agg()</code></a>
methods.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a>dat<span class="sc">$</span><span class="fu">groupby</span>(</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>  <span class="st">&quot;cyl&quot;</span>,</span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a>  <span class="at">maintain_order =</span> <span class="cn">TRUE</span></span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a>)<span class="sc">$</span><span class="fu">agg</span>(</span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a>  pl<span class="sc">$</span><span class="fu">col</span>(<span class="fu">c</span>(<span class="st">&quot;mpg&quot;</span>, <span class="st">&quot;hp&quot;</span>))<span class="sc">$</span><span class="fu">sum</span>()</span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a>)</span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a><span class="co">#&gt; shape: (3, 3)</span></span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a><span class="co">#&gt; ┌─────┬───────┬────────┐</span></span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a><span class="co">#&gt; │ cyl ┆ mpg   ┆ hp     │</span></span>
<span id="cb17-10"><a href="#cb17-10" tabindex="-1"></a><span class="co">#&gt; │ --- ┆ ---   ┆ ---    │</span></span>
<span id="cb17-11"><a href="#cb17-11" tabindex="-1"></a><span class="co">#&gt; │ f64 ┆ f64   ┆ f64    │</span></span>
<span id="cb17-12"><a href="#cb17-12" tabindex="-1"></a><span class="co">#&gt; ╞═════╪═══════╪════════╡</span></span>
<span id="cb17-13"><a href="#cb17-13" tabindex="-1"></a><span class="co">#&gt; │ 6.0 ┆ 138.2 ┆ 856.0  │</span></span>
<span id="cb17-14"><a href="#cb17-14" tabindex="-1"></a><span class="co">#&gt; │ 4.0 ┆ 293.3 ┆ 909.0  │</span></span>
<span id="cb17-15"><a href="#cb17-15" tabindex="-1"></a><span class="co">#&gt; │ 8.0 ┆ 211.4 ┆ 2929.0 │</span></span>
<span id="cb17-16"><a href="#cb17-16" tabindex="-1"></a><span class="co">#&gt; └─────┴───────┴────────┘</span></span></code></pre></div>
<p>(arg <code>maintain_order = TRUE</code> is optional, since
<strong>polars</strong> doesn’t sort the results of grouped operations
by default. This is similar to what <strong>data.table</strong> does and
is also true for newer versions of <strong>dplyr</strong>.)</p>
<p>The same principles of method chaining can be combined very flexibly
to group by multiple variables and aggregation types.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a>dat<span class="sc">$</span><span class="fu">groupby</span>(</span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a>  <span class="st">&quot;cyl&quot;</span>,</span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a>  pl<span class="sc">$</span><span class="fu">col</span>(<span class="st">&quot;am&quot;</span>)<span class="sc">$</span><span class="fu">cast</span>(pl<span class="sc">$</span>Boolean)<span class="sc">$</span><span class="fu">alias</span>(<span class="st">&quot;manual&quot;</span>)</span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a>)<span class="sc">$</span><span class="fu">agg</span>(</span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a>  pl<span class="sc">$</span><span class="fu">col</span>(<span class="st">&quot;mpg&quot;</span>)<span class="sc">$</span><span class="fu">mean</span>()<span class="sc">$</span><span class="fu">alias</span>(<span class="st">&quot;mean_mpg&quot;</span>),</span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a>  pl<span class="sc">$</span><span class="fu">col</span>(<span class="st">&quot;hp&quot;</span>)<span class="sc">$</span><span class="fu">median</span>()<span class="sc">$</span><span class="fu">alias</span>(<span class="st">&quot;med_hp&quot;</span>)</span>
<span id="cb18-7"><a href="#cb18-7" tabindex="-1"></a>)</span>
<span id="cb18-8"><a href="#cb18-8" tabindex="-1"></a><span class="co">#&gt; shape: (6, 4)</span></span>
<span id="cb18-9"><a href="#cb18-9" tabindex="-1"></a><span class="co">#&gt; ┌─────┬────────┬───────────┬────────┐</span></span>
<span id="cb18-10"><a href="#cb18-10" tabindex="-1"></a><span class="co">#&gt; │ cyl ┆ manual ┆ mean_mpg  ┆ med_hp │</span></span>
<span id="cb18-11"><a href="#cb18-11" tabindex="-1"></a><span class="co">#&gt; │ --- ┆ ---    ┆ ---       ┆ ---    │</span></span>
<span id="cb18-12"><a href="#cb18-12" tabindex="-1"></a><span class="co">#&gt; │ f64 ┆ bool   ┆ f64       ┆ f64    │</span></span>
<span id="cb18-13"><a href="#cb18-13" tabindex="-1"></a><span class="co">#&gt; ╞═════╪════════╪═══════════╪════════╡</span></span>
<span id="cb18-14"><a href="#cb18-14" tabindex="-1"></a><span class="co">#&gt; │ 6.0 ┆ true   ┆ 20.566667 ┆ 110.0  │</span></span>
<span id="cb18-15"><a href="#cb18-15" tabindex="-1"></a><span class="co">#&gt; │ 6.0 ┆ false  ┆ 19.125    ┆ 116.5  │</span></span>
<span id="cb18-16"><a href="#cb18-16" tabindex="-1"></a><span class="co">#&gt; │ 4.0 ┆ true   ┆ 28.075    ┆ 78.5   │</span></span>
<span id="cb18-17"><a href="#cb18-17" tabindex="-1"></a><span class="co">#&gt; │ 4.0 ┆ false  ┆ 22.9      ┆ 95.0   │</span></span>
<span id="cb18-18"><a href="#cb18-18" tabindex="-1"></a><span class="co">#&gt; │ 8.0 ┆ false  ┆ 15.05     ┆ 180.0  │</span></span>
<span id="cb18-19"><a href="#cb18-19" tabindex="-1"></a><span class="co">#&gt; │ 8.0 ┆ true   ┆ 15.4      ┆ 299.5  │</span></span>
<span id="cb18-20"><a href="#cb18-20" tabindex="-1"></a><span class="co">#&gt; └─────┴────────┴───────────┴────────┘</span></span></code></pre></div>
<p>Note that we used the <code>cast</code> method to convert the data
type of the <code>am</code> column. See the section below for more
details on data types.</p>
</div>
<div id="reshape" class="section level2">
<h2>Reshape</h2>
<p>Polars supports data reshaping, going from both long to wide
(“pivot”) and wide to long (“melt”). Let’s switch to the
<code>Indometh</code> dataset to demonstrate some basic examples. Note
that the data are currently in long format.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a>(<span class="at">indo =</span> pl<span class="sc">$</span><span class="fu">DataFrame</span>(Indometh))</span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a><span class="co">#&gt; shape: (66, 3)</span></span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a><span class="co">#&gt; ┌─────────┬──────┬──────┐</span></span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a><span class="co">#&gt; │ Subject ┆ time ┆ conc │</span></span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a><span class="co">#&gt; │ ---     ┆ ---  ┆ ---  │</span></span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a><span class="co">#&gt; │ cat     ┆ f64  ┆ f64  │</span></span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a><span class="co">#&gt; ╞═════════╪══════╪══════╡</span></span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a><span class="co">#&gt; │ 1       ┆ 0.25 ┆ 1.5  │</span></span>
<span id="cb19-9"><a href="#cb19-9" tabindex="-1"></a><span class="co">#&gt; │ 1       ┆ 0.5  ┆ 0.94 │</span></span>
<span id="cb19-10"><a href="#cb19-10" tabindex="-1"></a><span class="co">#&gt; │ 1       ┆ 0.75 ┆ 0.78 │</span></span>
<span id="cb19-11"><a href="#cb19-11" tabindex="-1"></a><span class="co">#&gt; │ 1       ┆ 1.0  ┆ 0.48 │</span></span>
<span id="cb19-12"><a href="#cb19-12" tabindex="-1"></a><span class="co">#&gt; │ …       ┆ …    ┆ …    │</span></span>
<span id="cb19-13"><a href="#cb19-13" tabindex="-1"></a><span class="co">#&gt; │ 6       ┆ 4.0  ┆ 0.17 │</span></span>
<span id="cb19-14"><a href="#cb19-14" tabindex="-1"></a><span class="co">#&gt; │ 6       ┆ 5.0  ┆ 0.13 │</span></span>
<span id="cb19-15"><a href="#cb19-15" tabindex="-1"></a><span class="co">#&gt; │ 6       ┆ 6.0  ┆ 0.1  │</span></span>
<span id="cb19-16"><a href="#cb19-16" tabindex="-1"></a><span class="co">#&gt; │ 6       ┆ 8.0  ┆ 0.09 │</span></span>
<span id="cb19-17"><a href="#cb19-17" tabindex="-1"></a><span class="co">#&gt; └─────────┴──────┴──────┘</span></span></code></pre></div>
<p>To go from long to wide, we use the <a href="https://rpolars.github.io/reference/DataFrame_pivot/"><code>pivot</code></a>
method. Here we pivot the data so that every subject takes its own
column.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a>(<span class="at">indo_wide =</span> indo<span class="sc">$</span><span class="fu">pivot</span>(<span class="at">values =</span> <span class="st">&quot;conc&quot;</span>, <span class="at">index =</span> <span class="st">&quot;time&quot;</span>, <span class="at">columns =</span> <span class="st">&quot;Subject&quot;</span>))</span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a><span class="co">#&gt; shape: (11, 7)</span></span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a><span class="co">#&gt; ┌──────┬──────┬──────┬──────┬──────┬──────┬──────┐</span></span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a><span class="co">#&gt; │ time ┆ 1    ┆ 2    ┆ 3    ┆ 4    ┆ 5    ┆ 6    │</span></span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a><span class="co">#&gt; │ ---  ┆ ---  ┆ ---  ┆ ---  ┆ ---  ┆ ---  ┆ ---  │</span></span>
<span id="cb20-6"><a href="#cb20-6" tabindex="-1"></a><span class="co">#&gt; │ f64  ┆ f64  ┆ f64  ┆ f64  ┆ f64  ┆ f64  ┆ f64  │</span></span>
<span id="cb20-7"><a href="#cb20-7" tabindex="-1"></a><span class="co">#&gt; ╞══════╪══════╪══════╪══════╪══════╪══════╪══════╡</span></span>
<span id="cb20-8"><a href="#cb20-8" tabindex="-1"></a><span class="co">#&gt; │ 0.25 ┆ 1.5  ┆ 2.03 ┆ 2.72 ┆ 1.85 ┆ 2.05 ┆ 2.31 │</span></span>
<span id="cb20-9"><a href="#cb20-9" tabindex="-1"></a><span class="co">#&gt; │ 0.5  ┆ 0.94 ┆ 1.63 ┆ 1.49 ┆ 1.39 ┆ 1.04 ┆ 1.44 │</span></span>
<span id="cb20-10"><a href="#cb20-10" tabindex="-1"></a><span class="co">#&gt; │ 0.75 ┆ 0.78 ┆ 0.71 ┆ 1.16 ┆ 1.02 ┆ 0.81 ┆ 1.03 │</span></span>
<span id="cb20-11"><a href="#cb20-11" tabindex="-1"></a><span class="co">#&gt; │ 1.0  ┆ 0.48 ┆ 0.7  ┆ 0.8  ┆ 0.89 ┆ 0.39 ┆ 0.84 │</span></span>
<span id="cb20-12"><a href="#cb20-12" tabindex="-1"></a><span class="co">#&gt; │ …    ┆ …    ┆ …    ┆ …    ┆ …    ┆ …    ┆ …    │</span></span>
<span id="cb20-13"><a href="#cb20-13" tabindex="-1"></a><span class="co">#&gt; │ 4.0  ┆ 0.11 ┆ 0.2  ┆ 0.12 ┆ 0.11 ┆ 0.11 ┆ 0.17 │</span></span>
<span id="cb20-14"><a href="#cb20-14" tabindex="-1"></a><span class="co">#&gt; │ 5.0  ┆ 0.08 ┆ 0.25 ┆ 0.11 ┆ 0.1  ┆ 0.08 ┆ 0.13 │</span></span>
<span id="cb20-15"><a href="#cb20-15" tabindex="-1"></a><span class="co">#&gt; │ 6.0  ┆ 0.07 ┆ 0.12 ┆ 0.08 ┆ 0.07 ┆ 0.1  ┆ 0.1  │</span></span>
<span id="cb20-16"><a href="#cb20-16" tabindex="-1"></a><span class="co">#&gt; │ 8.0  ┆ 0.05 ┆ 0.08 ┆ 0.08 ┆ 0.07 ┆ 0.06 ┆ 0.09 │</span></span>
<span id="cb20-17"><a href="#cb20-17" tabindex="-1"></a><span class="co">#&gt; └──────┴──────┴──────┴──────┴──────┴──────┴──────┘</span></span></code></pre></div>
<p>To go from wide to long, we use the <a href="https://rpolars.github.io/reference/DataFrame_melt/">melt</a>
method.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="co"># indo_wide$melt(id_vars = &quot;time&quot;) # default column names are &quot;variable&quot; and &quot;value&quot;</span></span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a>indo_wide<span class="sc">$</span><span class="fu">melt</span>(<span class="at">id_vars =</span> <span class="st">&quot;time&quot;</span>, <span class="at">variable_name =</span> <span class="st">&quot;subject&quot;</span>, <span class="at">value_name =</span> <span class="st">&quot;conc&quot;</span>) </span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a><span class="co">#&gt; shape: (66, 3)</span></span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a><span class="co">#&gt; ┌──────┬─────────┬──────┐</span></span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a><span class="co">#&gt; │ time ┆ subject ┆ conc │</span></span>
<span id="cb21-6"><a href="#cb21-6" tabindex="-1"></a><span class="co">#&gt; │ ---  ┆ ---     ┆ ---  │</span></span>
<span id="cb21-7"><a href="#cb21-7" tabindex="-1"></a><span class="co">#&gt; │ f64  ┆ str     ┆ f64  │</span></span>
<span id="cb21-8"><a href="#cb21-8" tabindex="-1"></a><span class="co">#&gt; ╞══════╪═════════╪══════╡</span></span>
<span id="cb21-9"><a href="#cb21-9" tabindex="-1"></a><span class="co">#&gt; │ 0.25 ┆ 1       ┆ 1.5  │</span></span>
<span id="cb21-10"><a href="#cb21-10" tabindex="-1"></a><span class="co">#&gt; │ 0.5  ┆ 1       ┆ 0.94 │</span></span>
<span id="cb21-11"><a href="#cb21-11" tabindex="-1"></a><span class="co">#&gt; │ 0.75 ┆ 1       ┆ 0.78 │</span></span>
<span id="cb21-12"><a href="#cb21-12" tabindex="-1"></a><span class="co">#&gt; │ 1.0  ┆ 1       ┆ 0.48 │</span></span>
<span id="cb21-13"><a href="#cb21-13" tabindex="-1"></a><span class="co">#&gt; │ …    ┆ …       ┆ …    │</span></span>
<span id="cb21-14"><a href="#cb21-14" tabindex="-1"></a><span class="co">#&gt; │ 4.0  ┆ 6       ┆ 0.17 │</span></span>
<span id="cb21-15"><a href="#cb21-15" tabindex="-1"></a><span class="co">#&gt; │ 5.0  ┆ 6       ┆ 0.13 │</span></span>
<span id="cb21-16"><a href="#cb21-16" tabindex="-1"></a><span class="co">#&gt; │ 6.0  ┆ 6       ┆ 0.1  │</span></span>
<span id="cb21-17"><a href="#cb21-17" tabindex="-1"></a><span class="co">#&gt; │ 8.0  ┆ 6       ┆ 0.09 │</span></span>
<span id="cb21-18"><a href="#cb21-18" tabindex="-1"></a><span class="co">#&gt; └──────┴─────────┴──────┘</span></span></code></pre></div>
<p>Basic functionality aside, it should be noted that <code>pivot</code>
can perform aggregations as part of the reshaping operation. This is
useful when you have multiple observations per ID variable that need to
be collapsed into unique values. The aggregating functions can be
arbitrarily complex, but let’s consider a relatively simple example
using our <code>dat</code> (“mtcars”) DataFrame from earlier: what is
the median MPG value (<code>mpg</code>) across cylinders
(<code>cyl</code>), cut by different combinations of transmission type
(<code>am</code>) and engine shape (<code>vs</code>)?</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a>dat<span class="sc">$</span><span class="fu">pivot</span>(</span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a>  <span class="at">values =</span> <span class="st">&quot;mpg&quot;</span>,</span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a>  <span class="at">index =</span> <span class="fu">c</span>(<span class="st">&quot;am&quot;</span>, <span class="st">&quot;vs&quot;</span>),</span>
<span id="cb22-4"><a href="#cb22-4" tabindex="-1"></a>  <span class="at">columns =</span> <span class="st">&quot;cyl&quot;</span>,</span>
<span id="cb22-5"><a href="#cb22-5" tabindex="-1"></a>  <span class="at">aggregate_fun =</span> <span class="st">&quot;median&quot;</span> <span class="co"># aggregating function</span></span>
<span id="cb22-6"><a href="#cb22-6" tabindex="-1"></a>)</span>
<span id="cb22-7"><a href="#cb22-7" tabindex="-1"></a><span class="co">#&gt; shape: (4, 5)</span></span>
<span id="cb22-8"><a href="#cb22-8" tabindex="-1"></a><span class="co">#&gt; ┌─────┬─────┬───────┬──────┬──────┐</span></span>
<span id="cb22-9"><a href="#cb22-9" tabindex="-1"></a><span class="co">#&gt; │ am  ┆ vs  ┆ 6.0   ┆ 4.0  ┆ 8.0  │</span></span>
<span id="cb22-10"><a href="#cb22-10" tabindex="-1"></a><span class="co">#&gt; │ --- ┆ --- ┆ ---   ┆ ---  ┆ ---  │</span></span>
<span id="cb22-11"><a href="#cb22-11" tabindex="-1"></a><span class="co">#&gt; │ f64 ┆ f64 ┆ f64   ┆ f64  ┆ f64  │</span></span>
<span id="cb22-12"><a href="#cb22-12" tabindex="-1"></a><span class="co">#&gt; ╞═════╪═════╪═══════╪══════╪══════╡</span></span>
<span id="cb22-13"><a href="#cb22-13" tabindex="-1"></a><span class="co">#&gt; │ 1.0 ┆ 0.0 ┆ 21.0  ┆ 26.0 ┆ 15.4 │</span></span>
<span id="cb22-14"><a href="#cb22-14" tabindex="-1"></a><span class="co">#&gt; │ 1.0 ┆ 1.0 ┆ null  ┆ 30.4 ┆ null │</span></span>
<span id="cb22-15"><a href="#cb22-15" tabindex="-1"></a><span class="co">#&gt; │ 0.0 ┆ 1.0 ┆ 18.65 ┆ 22.8 ┆ null │</span></span>
<span id="cb22-16"><a href="#cb22-16" tabindex="-1"></a><span class="co">#&gt; │ 0.0 ┆ 0.0 ┆ null  ┆ null ┆ 15.2 │</span></span>
<span id="cb22-17"><a href="#cb22-17" tabindex="-1"></a><span class="co">#&gt; └─────┴─────┴───────┴──────┴──────┘</span></span></code></pre></div>
<p>Here, <code>&quot;median&quot;</code> is a convenience string that is
equivalent to the more verbose <code>pl$element()$median()</code>. Other
convenience strings include “first”, “last”, “min”, “max”, “mean”,
“sum”, and “count”.</p>
</div>
<div id="join" class="section level2">
<h2>Join</h2>
<p>As a final example of how <strong>polars</strong> can be used for
standard data wrangling tasks, let’s implement a (left) join. For this
example, we’ll borrow some datasets from the
<strong>nycflights13</strong> package.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;flights&quot;</span>, <span class="st">&quot;planes&quot;</span>, <span class="at">package =</span> <span class="st">&quot;nycflights13&quot;</span>)</span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a>flights <span class="ot">=</span> pl<span class="sc">$</span><span class="fu">DataFrame</span>(flights)</span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a>planes <span class="ot">=</span> pl<span class="sc">$</span><span class="fu">DataFrame</span>(planes)</span>
<span id="cb23-4"><a href="#cb23-4" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" tabindex="-1"></a>flights<span class="sc">$</span><span class="fu">join</span>(</span>
<span id="cb23-6"><a href="#cb23-6" tabindex="-1"></a>  planes,</span>
<span id="cb23-7"><a href="#cb23-7" tabindex="-1"></a>  <span class="at">on =</span> <span class="st">&quot;tailnum&quot;</span>,</span>
<span id="cb23-8"><a href="#cb23-8" tabindex="-1"></a>  <span class="at">how =</span> <span class="st">&quot;left&quot;</span></span>
<span id="cb23-9"><a href="#cb23-9" tabindex="-1"></a>)</span>
<span id="cb23-10"><a href="#cb23-10" tabindex="-1"></a><span class="co">#&gt; shape: (336_776, 27)</span></span>
<span id="cb23-11"><a href="#cb23-11" tabindex="-1"></a><span class="co">#&gt; ┌──────┬───────┬─────┬──────────┬───┬─────────┬───────┬───────┬───────────┐</span></span>
<span id="cb23-12"><a href="#cb23-12" tabindex="-1"></a><span class="co">#&gt; │ year ┆ month ┆ day ┆ dep_time ┆ … ┆ engines ┆ seats ┆ speed ┆ engine    │</span></span>
<span id="cb23-13"><a href="#cb23-13" tabindex="-1"></a><span class="co">#&gt; │ ---  ┆ ---   ┆ --- ┆ ---      ┆   ┆ ---     ┆ ---   ┆ ---   ┆ ---       │</span></span>
<span id="cb23-14"><a href="#cb23-14" tabindex="-1"></a><span class="co">#&gt; │ i32  ┆ i32   ┆ i32 ┆ i32      ┆   ┆ i32     ┆ i32   ┆ i32   ┆ str       │</span></span>
<span id="cb23-15"><a href="#cb23-15" tabindex="-1"></a><span class="co">#&gt; ╞══════╪═══════╪═════╪══════════╪═══╪═════════╪═══════╪═══════╪═══════════╡</span></span>
<span id="cb23-16"><a href="#cb23-16" tabindex="-1"></a><span class="co">#&gt; │ 2013 ┆ 1     ┆ 1   ┆ 517      ┆ … ┆ 2       ┆ 149   ┆ null  ┆ Turbo-fan │</span></span>
<span id="cb23-17"><a href="#cb23-17" tabindex="-1"></a><span class="co">#&gt; │ 2013 ┆ 1     ┆ 1   ┆ 533      ┆ … ┆ 2       ┆ 149   ┆ null  ┆ Turbo-fan │</span></span>
<span id="cb23-18"><a href="#cb23-18" tabindex="-1"></a><span class="co">#&gt; │ 2013 ┆ 1     ┆ 1   ┆ 542      ┆ … ┆ 2       ┆ 178   ┆ null  ┆ Turbo-fan │</span></span>
<span id="cb23-19"><a href="#cb23-19" tabindex="-1"></a><span class="co">#&gt; │ 2013 ┆ 1     ┆ 1   ┆ 544      ┆ … ┆ 2       ┆ 200   ┆ null  ┆ Turbo-fan │</span></span>
<span id="cb23-20"><a href="#cb23-20" tabindex="-1"></a><span class="co">#&gt; │ …    ┆ …     ┆ …   ┆ …        ┆ … ┆ …       ┆ …     ┆ …     ┆ …         │</span></span>
<span id="cb23-21"><a href="#cb23-21" tabindex="-1"></a><span class="co">#&gt; │ 2013 ┆ 9     ┆ 30  ┆ null     ┆ … ┆ null    ┆ null  ┆ null  ┆ null      │</span></span>
<span id="cb23-22"><a href="#cb23-22" tabindex="-1"></a><span class="co">#&gt; │ 2013 ┆ 9     ┆ 30  ┆ null     ┆ … ┆ null    ┆ null  ┆ null  ┆ null      │</span></span>
<span id="cb23-23"><a href="#cb23-23" tabindex="-1"></a><span class="co">#&gt; │ 2013 ┆ 9     ┆ 30  ┆ null     ┆ … ┆ null    ┆ null  ┆ null  ┆ null      │</span></span>
<span id="cb23-24"><a href="#cb23-24" tabindex="-1"></a><span class="co">#&gt; │ 2013 ┆ 9     ┆ 30  ┆ null     ┆ … ┆ null    ┆ null  ┆ null  ┆ null      │</span></span>
<span id="cb23-25"><a href="#cb23-25" tabindex="-1"></a><span class="co">#&gt; └──────┴───────┴─────┴──────────┴───┴─────────┴───────┴───────┴───────────┘</span></span></code></pre></div>
<p>More information on the <strong>polars</strong> joining method can be
found in the <a href="https://rpolars.github.io/reference/DataFrame_join/">reference
manual</a>.</p>
<p>The package supports many other data manipulation operations, which
we won’t cover here. Hopefully, you will already have a sense of the key
syntax features. We now turn to another core idea of the Polars
ecosystem: <em>lazy execution</em>.</p>
</div>
<div id="lazy-execution" class="section level2">
<h2>Lazy execution</h2>
<p>While the “eager” execution engine of <strong>polars</strong> works
perfectly well—as evidenced by all of the previous examples—to get the
most out of the package you need to go <em>lazy</em>. Lazy execution
enables several benefits, but the most important is that it improves
performance. Delaying execution until the last possible moment allows
Polars to apply automatic optimization to every query. Let’s take a
quick look.</p>
<p>To create a so-called “<a href="https://rpolars.github.io/reference/LazyFrame_class/">LazyFrame</a>”
from an existing object in memory, we can invoke the <code>lazy()</code>
constructor.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a>ldat <span class="ot">=</span> dat<span class="sc">$</span><span class="fu">lazy</span>()</span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a>ldat</span>
<span id="cb24-3"><a href="#cb24-3" tabindex="-1"></a><span class="co">#&gt; [1] &quot;polars LazyFrame naive plan: (run ldf$describe_optimized_plan() to see the optimized plan)&quot;</span></span>
<span id="cb24-4"><a href="#cb24-4" tabindex="-1"></a><span class="co">#&gt; DF [&quot;mpg&quot;, &quot;cyl&quot;, &quot;disp&quot;, &quot;hp&quot;]; PROJECT */11 COLUMNS; SELECTION: &quot;None&quot;</span></span></code></pre></div>
<p>Now consider what happens when we run our subsetting query from
earlier on this LazyFrame.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a>subset_query <span class="ot">=</span> ldat<span class="sc">$</span><span class="fu">filter</span>(</span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a>  pl<span class="sc">$</span><span class="fu">col</span>(<span class="st">&quot;cyl&quot;</span>) <span class="sc">==</span> <span class="dv">6</span></span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a>)<span class="sc">$</span><span class="fu">select</span>(</span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a>  pl<span class="sc">$</span><span class="fu">col</span>(<span class="fu">c</span>(<span class="st">&quot;mpg&quot;</span>, <span class="st">&quot;hp&quot;</span>, <span class="st">&quot;cyl&quot;</span>))</span>
<span id="cb25-5"><a href="#cb25-5" tabindex="-1"></a>)</span>
<span id="cb25-6"><a href="#cb25-6" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" tabindex="-1"></a>subset_query</span>
<span id="cb25-8"><a href="#cb25-8" tabindex="-1"></a><span class="co">#&gt; [1] &quot;polars LazyFrame naive plan: (run ldf$describe_optimized_plan() to see the optimized plan)&quot;</span></span>
<span id="cb25-9"><a href="#cb25-9" tabindex="-1"></a><span class="co">#&gt;  SELECT [col(&quot;mpg&quot;), col(&quot;hp&quot;), col(&quot;cyl&quot;)] FROM</span></span>
<span id="cb25-10"><a href="#cb25-10" tabindex="-1"></a><span class="co">#&gt;   FILTER [(col(&quot;cyl&quot;)) == (6.0)] FROM</span></span>
<span id="cb25-11"><a href="#cb25-11" tabindex="-1"></a><span class="co">#&gt;   DF [&quot;mpg&quot;, &quot;cyl&quot;, &quot;disp&quot;, &quot;hp&quot;]; PROJECT */11 COLUMNS; SELECTION: &quot;None&quot;</span></span></code></pre></div>
<p>Right now we only have a tree of instructions. But underneath the
hood, Polars has already worked out a more optimized version of the
query. We can view this optimized plan this by requesting it.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a>subset_query<span class="sc">$</span><span class="fu">describe_optimized_plan</span>()</span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a><span class="co">#&gt; FAST_PROJECT: [mpg, hp, cyl]</span></span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a><span class="co">#&gt;   DF [&quot;mpg&quot;, &quot;cyl&quot;, &quot;disp&quot;, &quot;hp&quot;]; PROJECT 3/11 COLUMNS; SELECTION: &quot;[(col(\&quot;cyl\&quot;)) == (6.0)]&quot;</span></span></code></pre></div>
<p>Here we see a simple, but surprisingly effective component in query
optimization: <em>projection</em>. Changing the order in which our
subsetting operations occurs—in this case, subsetting on columns
first—reduces the memory overhead of the overall query and leads to a
downstream speedup. Of course, you would hardly notice a difference for
this small dataset. But the same principles carry over to much bigger
datasets and more complex queries.</p>
<p>To actually execute the plan, we just need to invoke the
<code>collect()</code> method. This should feel very familiar if you
have previously used other lazy execution engines like those provided by
<strong>arrow</strong> or <strong>dbplyr</strong>.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a>subset_query<span class="sc">$</span><span class="fu">collect</span>()</span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a><span class="co">#&gt; shape: (7, 3)</span></span>
<span id="cb27-3"><a href="#cb27-3" tabindex="-1"></a><span class="co">#&gt; ┌──────┬───────┬─────┐</span></span>
<span id="cb27-4"><a href="#cb27-4" tabindex="-1"></a><span class="co">#&gt; │ mpg  ┆ hp    ┆ cyl │</span></span>
<span id="cb27-5"><a href="#cb27-5" tabindex="-1"></a><span class="co">#&gt; │ ---  ┆ ---   ┆ --- │</span></span>
<span id="cb27-6"><a href="#cb27-6" tabindex="-1"></a><span class="co">#&gt; │ f64  ┆ f64   ┆ f64 │</span></span>
<span id="cb27-7"><a href="#cb27-7" tabindex="-1"></a><span class="co">#&gt; ╞══════╪═══════╪═════╡</span></span>
<span id="cb27-8"><a href="#cb27-8" tabindex="-1"></a><span class="co">#&gt; │ 21.0 ┆ 110.0 ┆ 6.0 │</span></span>
<span id="cb27-9"><a href="#cb27-9" tabindex="-1"></a><span class="co">#&gt; │ 21.0 ┆ 110.0 ┆ 6.0 │</span></span>
<span id="cb27-10"><a href="#cb27-10" tabindex="-1"></a><span class="co">#&gt; │ 21.4 ┆ 110.0 ┆ 6.0 │</span></span>
<span id="cb27-11"><a href="#cb27-11" tabindex="-1"></a><span class="co">#&gt; │ 18.1 ┆ 105.0 ┆ 6.0 │</span></span>
<span id="cb27-12"><a href="#cb27-12" tabindex="-1"></a><span class="co">#&gt; │ 19.2 ┆ 123.0 ┆ 6.0 │</span></span>
<span id="cb27-13"><a href="#cb27-13" tabindex="-1"></a><span class="co">#&gt; │ 17.8 ┆ 123.0 ┆ 6.0 │</span></span>
<span id="cb27-14"><a href="#cb27-14" tabindex="-1"></a><span class="co">#&gt; │ 19.7 ┆ 175.0 ┆ 6.0 │</span></span>
<span id="cb27-15"><a href="#cb27-15" tabindex="-1"></a><span class="co">#&gt; └──────┴───────┴─────┘</span></span></code></pre></div>
</div>
<div id="data-import" class="section level2">
<h2>Data import</h2>
<p><strong>polars</strong> supports data import of both CSV and Parquet
files formats. Here we demonstrate using the <code>airquality</code>
dataset that also comes bundled with base R.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a><span class="fu">write.csv</span>(airquality, <span class="st">&quot;airquality.csv&quot;</span>)</span>
<span id="cb28-2"><a href="#cb28-2" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" tabindex="-1"></a>pl<span class="sc">$</span><span class="fu">read_csv</span>(<span class="st">&quot;airquality.csv&quot;</span>)</span>
<span id="cb28-4"><a href="#cb28-4" tabindex="-1"></a><span class="co">#&gt; shape: (153, 7)</span></span>
<span id="cb28-5"><a href="#cb28-5" tabindex="-1"></a><span class="co">#&gt; ┌─────┬───────┬─────────┬──────┬──────┬───────┬─────┐</span></span>
<span id="cb28-6"><a href="#cb28-6" tabindex="-1"></a><span class="co">#&gt; │     ┆ Ozone ┆ Solar.R ┆ Wind ┆ Temp ┆ Month ┆ Day │</span></span>
<span id="cb28-7"><a href="#cb28-7" tabindex="-1"></a><span class="co">#&gt; │ --- ┆ ---   ┆ ---     ┆ ---  ┆ ---  ┆ ---   ┆ --- │</span></span>
<span id="cb28-8"><a href="#cb28-8" tabindex="-1"></a><span class="co">#&gt; │ i64 ┆ str   ┆ str     ┆ f64  ┆ i64  ┆ i64   ┆ i64 │</span></span>
<span id="cb28-9"><a href="#cb28-9" tabindex="-1"></a><span class="co">#&gt; ╞═════╪═══════╪═════════╪══════╪══════╪═══════╪═════╡</span></span>
<span id="cb28-10"><a href="#cb28-10" tabindex="-1"></a><span class="co">#&gt; │ 1   ┆ 41    ┆ 190     ┆ 7.4  ┆ 67   ┆ 5     ┆ 1   │</span></span>
<span id="cb28-11"><a href="#cb28-11" tabindex="-1"></a><span class="co">#&gt; │ 2   ┆ 36    ┆ 118     ┆ 8.0  ┆ 72   ┆ 5     ┆ 2   │</span></span>
<span id="cb28-12"><a href="#cb28-12" tabindex="-1"></a><span class="co">#&gt; │ 3   ┆ 12    ┆ 149     ┆ 12.6 ┆ 74   ┆ 5     ┆ 3   │</span></span>
<span id="cb28-13"><a href="#cb28-13" tabindex="-1"></a><span class="co">#&gt; │ 4   ┆ 18    ┆ 313     ┆ 11.5 ┆ 62   ┆ 5     ┆ 4   │</span></span>
<span id="cb28-14"><a href="#cb28-14" tabindex="-1"></a><span class="co">#&gt; │ …   ┆ …     ┆ …       ┆ …    ┆ …    ┆ …     ┆ …   │</span></span>
<span id="cb28-15"><a href="#cb28-15" tabindex="-1"></a><span class="co">#&gt; │ 150 ┆ NA    ┆ 145     ┆ 13.2 ┆ 77   ┆ 9     ┆ 27  │</span></span>
<span id="cb28-16"><a href="#cb28-16" tabindex="-1"></a><span class="co">#&gt; │ 151 ┆ 14    ┆ 191     ┆ 14.3 ┆ 75   ┆ 9     ┆ 28  │</span></span>
<span id="cb28-17"><a href="#cb28-17" tabindex="-1"></a><span class="co">#&gt; │ 152 ┆ 18    ┆ 131     ┆ 8.0  ┆ 76   ┆ 9     ┆ 29  │</span></span>
<span id="cb28-18"><a href="#cb28-18" tabindex="-1"></a><span class="co">#&gt; │ 153 ┆ 20    ┆ 223     ┆ 11.5 ┆ 68   ┆ 9     ┆ 30  │</span></span>
<span id="cb28-19"><a href="#cb28-19" tabindex="-1"></a><span class="co">#&gt; └─────┴───────┴─────────┴──────┴──────┴───────┴─────┘</span></span></code></pre></div>
<p>Again, however, the package works best if we take the lazy
approach.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a>pl<span class="sc">$</span><span class="fu">scan_csv</span>(<span class="st">&quot;airquality.csv&quot;</span>)</span>
<span id="cb29-2"><a href="#cb29-2" tabindex="-1"></a><span class="co">#&gt; [1] &quot;polars LazyFrame naive plan: (run ldf$describe_optimized_plan() to see the optimized plan)&quot;</span></span>
<span id="cb29-3"><a href="#cb29-3" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb29-4"><a href="#cb29-4" tabindex="-1"></a><span class="co">#&gt;   CSV SCAN airquality.csv</span></span>
<span id="cb29-5"><a href="#cb29-5" tabindex="-1"></a><span class="co">#&gt;   PROJECT */7 COLUMNS</span></span></code></pre></div>
<p>We could obviously append a set of query operators to the above
LazyFrame and then collect the results. However, this workflow is even
better suited to Parquet files, since we can leverage their efficient
storage format on disk. Let’s see an example.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a><span class="fu">library</span>(arrow)</span>
<span id="cb30-2"><a href="#cb30-2" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb30-3"><a href="#cb30-3" tabindex="-1"></a><span class="co">#&gt; Attaching package: &#39;arrow&#39;</span></span>
<span id="cb30-4"><a href="#cb30-4" tabindex="-1"></a><span class="co">#&gt; The following object is masked from &#39;package:utils&#39;:</span></span>
<span id="cb30-5"><a href="#cb30-5" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb30-6"><a href="#cb30-6" tabindex="-1"></a><span class="co">#&gt;     timestamp</span></span>
<span id="cb30-7"><a href="#cb30-7" tabindex="-1"></a></span>
<span id="cb30-8"><a href="#cb30-8" tabindex="-1"></a><span class="fu">write_parquet</span>(airquality, <span class="st">&quot;airquality.parquet&quot;</span>)</span>
<span id="cb30-9"><a href="#cb30-9" tabindex="-1"></a></span>
<span id="cb30-10"><a href="#cb30-10" tabindex="-1"></a><span class="co"># aq = read_parquet(&quot;airquality.parquet) # eager version (okay)</span></span>
<span id="cb30-11"><a href="#cb30-11" tabindex="-1"></a>aq <span class="ot">=</span> pl<span class="sc">$</span><span class="fu">scan_parquet</span>(<span class="st">&quot;airquality.parquet&quot;</span>) <span class="co"># lazy version (better)</span></span>
<span id="cb30-12"><a href="#cb30-12" tabindex="-1"></a></span>
<span id="cb30-13"><a href="#cb30-13" tabindex="-1"></a>aq<span class="sc">$</span><span class="fu">filter</span>(</span>
<span id="cb30-14"><a href="#cb30-14" tabindex="-1"></a>  pl<span class="sc">$</span><span class="fu">col</span>(<span class="st">&quot;Month&quot;</span>) <span class="sc">&lt;=</span> <span class="dv">6</span></span>
<span id="cb30-15"><a href="#cb30-15" tabindex="-1"></a>)<span class="sc">$</span><span class="fu">groupby</span>(</span>
<span id="cb30-16"><a href="#cb30-16" tabindex="-1"></a>  <span class="st">&quot;Month&quot;</span></span>
<span id="cb30-17"><a href="#cb30-17" tabindex="-1"></a>)<span class="sc">$</span><span class="fu">agg</span>(</span>
<span id="cb30-18"><a href="#cb30-18" tabindex="-1"></a>  pl<span class="sc">$</span><span class="fu">col</span>(<span class="fu">c</span>(<span class="st">&quot;Ozone&quot;</span>, <span class="st">&quot;Temp&quot;</span>))<span class="sc">$</span><span class="fu">mean</span>()</span>
<span id="cb30-19"><a href="#cb30-19" tabindex="-1"></a>)<span class="sc">$</span><span class="fu">collect</span>()</span>
<span id="cb30-20"><a href="#cb30-20" tabindex="-1"></a><span class="co">#&gt; shape: (2, 3)</span></span>
<span id="cb30-21"><a href="#cb30-21" tabindex="-1"></a><span class="co">#&gt; ┌───────┬───────────┬───────────┐</span></span>
<span id="cb30-22"><a href="#cb30-22" tabindex="-1"></a><span class="co">#&gt; │ Month ┆ Ozone     ┆ Temp      │</span></span>
<span id="cb30-23"><a href="#cb30-23" tabindex="-1"></a><span class="co">#&gt; │ ---   ┆ ---       ┆ ---       │</span></span>
<span id="cb30-24"><a href="#cb30-24" tabindex="-1"></a><span class="co">#&gt; │ i32   ┆ f64       ┆ f64       │</span></span>
<span id="cb30-25"><a href="#cb30-25" tabindex="-1"></a><span class="co">#&gt; ╞═══════╪═══════════╪═══════════╡</span></span>
<span id="cb30-26"><a href="#cb30-26" tabindex="-1"></a><span class="co">#&gt; │ 5     ┆ 23.615385 ┆ 65.548387 │</span></span>
<span id="cb30-27"><a href="#cb30-27" tabindex="-1"></a><span class="co">#&gt; │ 6     ┆ 29.444444 ┆ 79.1      │</span></span>
<span id="cb30-28"><a href="#cb30-28" tabindex="-1"></a><span class="co">#&gt; └───────┴───────────┴───────────┘</span></span></code></pre></div>
<p>Finally, can read/scan multiple files in the same directory through
pattern globbing. However, please note that partition-aware scanning is
not yet supported out of the box (e.g., Hive-style partitioned
datasets). Follow <a href="https://github.com/pola-rs/polars/issues/4347">this issue</a> for
more details about when this will be resolved.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="st">&quot;airquality-ds&quot;</span>)</span>
<span id="cb31-2"><a href="#cb31-2" tabindex="-1"></a><span class="fu">write_dataset</span>(airquality, <span class="st">&quot;airquality-ds&quot;</span>, <span class="at">partitioning =</span> <span class="st">&quot;Month&quot;</span>)</span>
<span id="cb31-3"><a href="#cb31-3" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" tabindex="-1"></a><span class="co"># Use pattern globbing to scan all parquet files in the folder</span></span>
<span id="cb31-5"><a href="#cb31-5" tabindex="-1"></a>aq2 <span class="ot">=</span> pl<span class="sc">$</span><span class="fu">scan_parquet</span>(<span class="st">&quot;airquality-ds/*/*.parquet&quot;</span>)</span>
<span id="cb31-6"><a href="#cb31-6" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" tabindex="-1"></a><span class="co"># Just print the first two rows. But note that the Month column</span></span>
<span id="cb31-8"><a href="#cb31-8" tabindex="-1"></a><span class="co"># (which we used for partitioning) is missing.</span></span>
<span id="cb31-9"><a href="#cb31-9" tabindex="-1"></a>aq2<span class="sc">$</span><span class="fu">limit</span>(<span class="dv">2</span>)<span class="sc">$</span><span class="fu">collect</span>()</span>
<span id="cb31-10"><a href="#cb31-10" tabindex="-1"></a><span class="co">#&gt; shape: (2, 5)</span></span>
<span id="cb31-11"><a href="#cb31-11" tabindex="-1"></a><span class="co">#&gt; ┌───────┬─────────┬──────┬──────┬─────┐</span></span>
<span id="cb31-12"><a href="#cb31-12" tabindex="-1"></a><span class="co">#&gt; │ Ozone ┆ Solar.R ┆ Wind ┆ Temp ┆ Day │</span></span>
<span id="cb31-13"><a href="#cb31-13" tabindex="-1"></a><span class="co">#&gt; │ ---   ┆ ---     ┆ ---  ┆ ---  ┆ --- │</span></span>
<span id="cb31-14"><a href="#cb31-14" tabindex="-1"></a><span class="co">#&gt; │ i32   ┆ i32     ┆ f64  ┆ i32  ┆ i32 │</span></span>
<span id="cb31-15"><a href="#cb31-15" tabindex="-1"></a><span class="co">#&gt; ╞═══════╪═════════╪══════╪══════╪═════╡</span></span>
<span id="cb31-16"><a href="#cb31-16" tabindex="-1"></a><span class="co">#&gt; │ 41    ┆ 190     ┆ 7.4  ┆ 67   ┆ 1   │</span></span>
<span id="cb31-17"><a href="#cb31-17" tabindex="-1"></a><span class="co">#&gt; │ 36    ┆ 118     ┆ 8.0  ┆ 72   ┆ 2   │</span></span>
<span id="cb31-18"><a href="#cb31-18" tabindex="-1"></a><span class="co">#&gt; └───────┴─────────┴──────┴──────┴─────┘</span></span></code></pre></div>
<p>Before continuing, don’t forget to clean up by removing the newly
created temp files and directory on disk.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a><span class="fu">file.remove</span>(<span class="fu">c</span>(<span class="st">&quot;airquality.csv&quot;</span>, <span class="st">&quot;airquality.parquet&quot;</span>))</span>
<span id="cb32-2"><a href="#cb32-2" tabindex="-1"></a><span class="co">#&gt; [1] TRUE TRUE</span></span>
<span id="cb32-3"><a href="#cb32-3" tabindex="-1"></a><span class="fu">unlink</span>(<span class="st">&quot;airquality-ds&quot;</span>, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
</div>
<div id="execute-r-functions-within-a-polars-query" class="section level2">
<h2>Execute R functions within a Polars query</h2>
<p>It is possible to mix R code with Polars by passing R functions to
<strong>polars</strong>. This can unlock a lot of flexibility, but note
that it can inhibit performance. R functions are typically slower, so we
recommend using native Polars functions and expressions wherever
possible.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a>pl<span class="sc">$</span><span class="fu">DataFrame</span>(iris)<span class="sc">$</span><span class="fu">select</span>(</span>
<span id="cb33-2"><a href="#cb33-2" tabindex="-1"></a>  pl<span class="sc">$</span><span class="fu">col</span>(<span class="st">&quot;Sepal.Length&quot;</span>)<span class="sc">$</span><span class="fu">map</span>(\(s) { <span class="co"># map with a R function</span></span>
<span id="cb33-3"><a href="#cb33-3" tabindex="-1"></a>    x <span class="ot">=</span> s<span class="sc">$</span><span class="fu">to_vector</span>() <span class="co"># convert from Polars Series to a native R vector</span></span>
<span id="cb33-4"><a href="#cb33-4" tabindex="-1"></a>    x[x <span class="sc">&gt;=</span> <span class="dv">5</span>] <span class="ot">=</span> <span class="dv">10</span></span>
<span id="cb33-5"><a href="#cb33-5" tabindex="-1"></a>    x[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>] <span class="co"># if return is R vector, it will automatically be converted to Polars Series again</span></span>
<span id="cb33-6"><a href="#cb33-6" tabindex="-1"></a>  })</span>
<span id="cb33-7"><a href="#cb33-7" tabindex="-1"></a>)<span class="sc">$</span><span class="fu">to_data_frame</span>()</span>
<span id="cb33-8"><a href="#cb33-8" tabindex="-1"></a><span class="co">#&gt;    Sepal.Length</span></span>
<span id="cb33-9"><a href="#cb33-9" tabindex="-1"></a><span class="co">#&gt; 1          10.0</span></span>
<span id="cb33-10"><a href="#cb33-10" tabindex="-1"></a><span class="co">#&gt; 2           4.9</span></span>
<span id="cb33-11"><a href="#cb33-11" tabindex="-1"></a><span class="co">#&gt; 3           4.7</span></span>
<span id="cb33-12"><a href="#cb33-12" tabindex="-1"></a><span class="co">#&gt; 4           4.6</span></span>
<span id="cb33-13"><a href="#cb33-13" tabindex="-1"></a><span class="co">#&gt; 5          10.0</span></span>
<span id="cb33-14"><a href="#cb33-14" tabindex="-1"></a><span class="co">#&gt; 6          10.0</span></span>
<span id="cb33-15"><a href="#cb33-15" tabindex="-1"></a><span class="co">#&gt; 7           4.6</span></span>
<span id="cb33-16"><a href="#cb33-16" tabindex="-1"></a><span class="co">#&gt; 8          10.0</span></span>
<span id="cb33-17"><a href="#cb33-17" tabindex="-1"></a><span class="co">#&gt; 9           4.4</span></span>
<span id="cb33-18"><a href="#cb33-18" tabindex="-1"></a><span class="co">#&gt; 10          4.9</span></span></code></pre></div>
</div>
<div id="data-types" class="section level2">
<h2>Data types</h2>
<p>Polars is <a href="https://en.wikipedia.org/wiki/Strong_and_weak_typing">strongly
typed</a> and new types can be created with the <code>dtypes</code>
constructor. For example:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a>pl<span class="sc">$</span>dtypes<span class="sc">$</span>Float64</span>
<span id="cb34-2"><a href="#cb34-2" tabindex="-1"></a><span class="co">#&gt; DataType: Float64</span></span></code></pre></div>
<p>The full list of valid Polars types can be found by typing
<code>pl$dtypes</code> into your R console. These include
<em>Boolean</em>, <em>Float32(64)</em>, <em>Int32(64)</em>,
<em>Utf8</em>, <em>Categorical</em>, <em>Date</em>, etc. Note that some
type names differ from what they are called in R (e.g., <em>Boolean</em>
in Polars is equivalent to <code>logical()</code> in R). This might
occasionally require you to look up a specific type. But the good news
is that <strong>polars</strong> generally does a good job of inferring
types automatically.</p>
</div>
<div class="footnotes footnotes-end-of-document">
<hr />
<ol>
<li id="fn1"><p>Similar to how (most) <strong>data.table</strong>
operations are limited to objects of class <code>data.table</code>, we
can only perform polars operations on objects that have been converted
to an appropriate <strong>polars</strong> class. Later on, we’ll see how
to read data from disk directly in Polars format.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
